<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layouts/adminDefault}">

	<th:block layout:fragment="customJsScript"> 
		<script type="text/javascript">
		
		/*Data Table*/
		$(document).ready(function () {
		    $('.table').DataTable({
		    	stateSave: true,
		    	destroy : true,
		    	ordering: false,
		    	order: [ [ 1, "asc" ] ],
		    	autowidth: false
		    });
		});
		
		/*유효성검사(비밀번호확인)*/
		
		function delCheck(){
			 
			var pwDelCheck = document.getElementById("pwDelCheck");
			var pwDelCheck2 = document.getElementById("pwDelCheck2");
			
			if(pwDelCheck.value == ""){
				alert("비밀번호를 입력하세요.")
				pwDelCheck.focus();
				return false;
			}
			else if(pwDelCheck.value !== pwDelCheck2.value){
					alert("비밀번호를 확인하세요.")
					pwDelCheck.focus();
					return false;
					
				} return true;
				 
		}
		
		</script>
		<style>
			
			table.dataTable {
				border-collapse: collapse !important;
				width: 100%;
			}			
			.table-striped td{
				vertical-align: middle;
			}
			.table-striped tr{
				text-align: center;
			}			
		</style>
	</th:block>		  
	  
	  
	<!-- 사용자정의 contents -->
	<th:block layout:fragment="customContents">
	
		
		<!-- 탭 이름 -->
		<h4><strong>리뷰 관리</strong></h4>
			<!-- 본문 내용 시작 -->
			<div class="container" style="margin-top: 50px;">
				<div class="col-md-12 col-sm-12">
					<div class="x_panel">
						<!-- 게시판 타이틀 -->
						<h4 style="margin: 20px;">리뷰</h4>
							<div class="x_title">					
								<div class="x_content">
									<div class="col-sm-12" style="margin-top: 50px;">
										<!-- 테이블 -->
										<table class="table table-striped table-bordered" style="width: 100%;">
											<thead>
												<tr>
													<th>번호</th>
													<th>세탁소명</th>
													<th>별점 </th>
													<th>내용</th>
													<th>작성자</th>
													<th>작성일</th>
													<th>삭제</th>	
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${not #lists.isEmpty(reviewList)}" th:each="l ,status : ${reviewList}">
													<tr th:if="${not #lists.isEmpty(l.LaundryList)}" th:each="sl :${l.LaundryList}">
														<td th:text="${l.reveiwNum}"></td>
														<td th:text="${sl.laundryName}"></td>
														<td th:text="${l.countingStar}"></td>
														<td th:text="${l.reviewContent}"  style="text-align: left;"></td>
														<td th:text="${l.memberId}"></td>
														<td th:text="${l.registTime}"></td>
														<td>
														<button type="button" class="btn btn-danger btn-sm" id="rv-remove" data-toggle="modal" th:data-target="${'#staticBackdrop'+status.count}">삭제</button>
															<input type="hidden" th:id ="${'reviewCode'+status.count}" name="reviewCode2" th:value="${l.reviewCode}">	
														</td>
												
													</tr>
													<tr th:unless="${not #lists.isEmpty(reviewList)}">
														<td colspan="7">조회된 내용이 없습니다.</td>
													</tr>
													
														<!-- 삭제 Modal -->
														<div class="modal fade" th:id="${'staticBackdrop'+status.count}" data-backdrop="static" data-keyboard="false" tabindex="-1" th:aria-labelledby="${'staticBackdropLabel'+status.count}" aria-hidden="true">
															<div class="modal-dialog">
														    	<div class="modal-content">
														      		<div class="modal-header">
														      			<h5 class="modal-title" th:id="${'staticBackdropLabel'+status.count}">정말로 삭제하시겠습니까?</h5>
																	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
																				<span aria-hidden="true">&times;</span>
																	        </button>
														     		</div>		      
																		<form class="rvDel" th:action="@{/admin/review}" method="POST">
																			<div class="modal-body">
																				<div style="text-align: center">
																		      		<h5>비밀번호 확인</h5>
																		      			<p>단, 삭제는 '대기' 상태일 때만 가능합니다.</p>
																		      				
																					      	<input type="text" id ="rvCode" name="reviewCode" th:value="${l.reviewCode}">	
																					      	<input type="password" id ="pwDelCheck" name="pwDelCheck" placeholder="비밀번호를 입력해주세요" required="required">
																									<input type="hidden" id ="pwDelCheck2" name="memberPw2" th:value="${member.memberPw}">
																				</div>
																			</div>
																      
																			<div class="modal-footer">
																		        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
																		        <a th:href="@{/admin/review}"><button type="submit" name="submit" value="submit" class="btn btn-danger" onclick="return delCheck()">삭제</button></a>
																		     </div>
																		</form>
																	</div>
																</div>
															</div>	
													<!-- 삭제 Modal 끝 -->
													
												</th:block>
											</tbody>
										</table>
										
												
									</div>
								</div>
							</div>
						</div>
					</div>
										
				</div>
				
				
	</th:block>

</html>